import { useState, useEffect, useRef, useCallback } from "react";

const SECTIONS = [
  { id: "plan", label: "Lernplan", icon: "üìã" },
  { id: "palace", label: "Ged√§chtnispalast", icon: "üèõÔ∏è" },
  { id: "slang", label: "Slang & G√≠rias", icon: "üó£Ô∏è" },
  { id: "quiz", label: "Quiz", icon: "‚úçÔ∏è" },
  { id: "conversa", label: "Conversa Di√°ria", icon: "üí¨" },
];

const FLUENCY_PLAN = {
  title: "Dein 6-Monats-Fluency-Plan",
  subtitle: "Von Null auf Portugiesisch ‚Äì Schritt f√ºr Schritt",
  phases: [
    {
      name: "Fase 1: Fundamento",
      weeks: "Woche 1‚Äì4",
      color: "#2dd4bf",
      skills: [
        {
          icon: "üëÇ",
          name: "H√∂ren (Ouvir)",
          tasks: [
            "15 Min/Tag: Brasilianische Musik mit Lyrics (Marisa Monte, Gilberto Gil)",
            "Podcast 'Caf√© Brasil' ‚Äì nur zuh√∂ren, nicht verstehen m√ºssen",
            "YouTube: 'Portuguese With Leo' ‚Äì Anf√§nger-Dialoge",
          ],
        },
        {
          icon: "üó£Ô∏è",
          name: "Sprechen (Falar)",
          tasks: [
            "10 Min/Tag: Nachsprechen von Begr√º√üungen & Zahlen",
            "Sprachaufnahme: Nimm dich selbst auf und vergleiche",
            "Spiegel-√úbung: Stell dich vor auf Portugiesisch",
          ],
        },
        {
          icon: "üìñ",
          name: "Lesen (Ler)",
          tasks: [
            "Kinderb√ºcher auf Portugiesisch (z.B. 'O Pequeno Pr√≠ncipe')",
            "T√§gliche Vokabelliste: 10 neue W√∂rter",
            "Instagram-Accounts: @aprabortuguese",
          ],
        },
        {
          icon: "‚úèÔ∏è",
          name: "Schreiben (Escrever)",
          tasks: [
            "Tagebuch: 3 S√§tze pro Tag auf Portugiesisch",
            "Vokabelkarten schreiben (handschriftlich!)",
            "WhatsApp-Nachrichten an dich selbst auf Portugiesisch",
          ],
        },
      ],
    },
    {
      name: "Fase 2: Constru√ß√£o",
      weeks: "Woche 5‚Äì12",
      color: "#f59e0b",
      skills: [
        {
          icon: "üëÇ",
          name: "H√∂ren (Ouvir)",
          tasks: [
            "20 Min/Tag: Brasilianische Serien mit PT-Untertiteln (3%, Cidade Invis√≠vel)",
            "Podcast 'Fala Gringo' ‚Äì mittleres Niveau",
            "Musik: Versuche mitzusingen (Anitta, Jorge Ben Jor)",
          ],
        },
        {
          icon: "üó£Ô∏è",
          name: "Sprechen (Falar)",
          tasks: [
            "15 Min/Tag: Tandem-Partner auf iTalki finden",
            "Rollenspiele: Im Restaurant bestellen, nach dem Weg fragen",
            "Shadowing: Sprich Podcasts Wort f√ºr Wort nach",
          ],
        },
        {
          icon: "üìñ",
          name: "Lesen (Ler)",
          tasks: [
            "Nachrichten: Globo.com Schlagzeilen lesen",
            "Kurzgeschichten: Clarice Lispector (vereinfacht)",
            "Reddit: r/brasil ‚Äì echte Konversationen lesen",
          ],
        },
        {
          icon: "‚úèÔ∏è",
          name: "Schreiben (Escrever)",
          tasks: [
            "Tagebuch: 1 Absatz pro Tag",
            "Kommentare auf brasilianischen Social-Media-Seiten",
            "Kurze E-Mails/Nachrichten an Tandem-Partner",
          ],
        },
      ],
    },
    {
      name: "Fase 3: Flu√™ncia",
      weeks: "Woche 13‚Äì24",
      color: "#ef4444",
      skills: [
        {
          icon: "üëÇ",
          name: "H√∂ren (Ouvir)",
          tasks: [
            "30 Min/Tag: Filme ohne Untertitel (Tropa de Elite, Central do Brasil)",
            "Brasilianische YouTuber: Felipe Neto, Whindersson Nunes",
            "H√∂rb√ºcher auf Portugiesisch",
          ],
        },
        {
          icon: "üó£Ô∏è",
          name: "Sprechen (Falar)",
          tasks: [
            "20 Min/Tag: Freie Konversation mit Muttersprachlern",
            "Pr√§sentationen auf Portugiesisch vorbereiten",
            "Am Telefon auf Portugiesisch sprechen (h√§rteste √úbung!)",
          ],
        },
        {
          icon: "üìñ",
          name: "Lesen (Ler)",
          tasks: [
            "Romane: Paulo Coelho, Machado de Assis",
            "Fachartikeln in deinem Berufsfeld",
            "Brasilianische Blogs und Meinungsartikel",
          ],
        },
        {
          icon: "‚úèÔ∏è",
          name: "Schreiben (Escrever)",
          tasks: [
            "Blog-Beitr√§ge oder Rezensionen auf Portugiesisch",
            "Berufliche E-Mails auf Portugiesisch",
            "Kreatives Schreiben: Kurzgeschichten",
          ],
        },
      ],
    },
  ],
};

const MEMORY_PALACE = [
  {
    room: "üö™ Eingang (Entrada)",
    scene:
      "Du √∂ffnest eine riesige Holzt√ºr. Ein goldener Schl√ºssel f√§llt herunter.",
    words: [
      { pt: "Ol√°", de: "Hallo", tip: "Der Schl√ºssel ruft 'Ol√°!' wenn er f√§llt" },
      { pt: "Sim", de: "Ja", tip: "Die T√ºr nickt ‚Äì SIM!" },
      { pt: "N√£o", de: "Nein", tip: "Die T√ºr sch√ºttelt sich ‚Äì N√ÉO!" },
      { pt: "Obrigado/a", de: "Danke", tip: "Ein Schild √ºber der T√ºr: OBRIGADO" },
      { pt: "Por favor", de: "Bitte", tip: "Eine Fu√ümatte mit 'POR FAVOR'" },
    ],
  },
  {
    room: "üõãÔ∏è Wohnzimmer (Sala)",
    scene:
      "Ein buntes Sofa explodiert mit Konfetti. Ein Papagei sitzt auf dem Fernseher.",
    words: [
      { pt: "Casa", de: "Haus", tip: "Das Sofa IST das ganze Haus ‚Äì CASA" },
      { pt: "√Ågua", de: "Wasser", tip: "Wasser sprudelt aus dem Fernseher ‚Äì √ÅGUA" },
      { pt: "Comida", de: "Essen", tip: "Der Papagei frisst Pizza ‚Äì COMIDA!" },
      { pt: "Bom", de: "Gut", tip: "Konfetti = BOM! Party!" },
      { pt: "Mau", de: "Schlecht", tip: "Der Papagei bei√üt ‚Äì MAU!" },
    ],
  },
  {
    room: "üç≥ K√ºche (Cozinha)",
    scene:
      "Ein Koch tanzt Samba und wirft Pfannkuchen in die Luft. Alles riecht nach Kaffee.",
    words: [
      { pt: "Caf√©", de: "Kaffee", tip: "Der Koch trinkt CAF√â und tanzt schneller" },
      { pt: "P√£o", de: "Brot", tip: "P√ÉO fliegt wie ein Frisbee durch die K√ºche" },
      { pt: "Comer", de: "Essen (Verb)", tip: "Der Koch stopft alles rein ‚Äì COMER!" },
      { pt: "Beber", de: "Trinken", tip: "Er trinkt aus einem Feuerwehrschlauch ‚Äì BEBER" },
      { pt: "Quente", de: "Hei√ü", tip: "Der Herd explodiert ‚Äì QUENTE!" },
    ],
  },
  {
    room: "üõèÔ∏è Schlafzimmer (Quarto)",
    scene:
      "Das Bett schwebt in der Luft. Ein Mond aus K√§se leuchtet durchs Fenster.",
    words: [
      { pt: "Dormir", de: "Schlafen", tip: "Du f√§llst aufs schwebende Bett ‚Äì DORMIR" },
      { pt: "Noite", de: "Nacht", tip: "Der K√§se-Mond fl√ºstert NOITE" },
      { pt: "Dia", de: "Tag", tip: "Pl√∂tzlich Sonnenlicht ‚Äì DIA!" },
      { pt: "Manh√£", de: "Morgen", tip: "Der Wecker schreit MANH√É!" },
      { pt: "Sonho", de: "Traum", tip: "Du tr√§umst du fliegst ‚Äì SONHO" },
    ],
  },
  {
    room: "üöø Badezimmer (Banheiro)",
    scene:
      "Der Spiegel spricht mit dir. Die Dusche regnet bunte Farben.",
    words: [
      { pt: "Bonito/a", de: "Sch√∂n", tip: "Der Spiegel sagt: 'Voc√™ √© BONITO!'" },
      { pt: "Grande", de: "Gro√ü", tip: "Du w√§chst im Spiegel ‚Äì GRANDE!" },
      { pt: "Pequeno", de: "Klein", tip: "Du schrumpfst ‚Äì PEQUENO!" },
      { pt: "Frio", de: "Kalt", tip: "Kalte Dusche ‚Äì FRIO! Du zitterst" },
      { pt: "Limpo", de: "Sauber", tip: "Alles gl√§nzt nach der Dusche ‚Äì LIMPO" },
    ],
  },
  {
    room: "üå≥ Garten (Jardim)",
    scene:
      "Riesige tropische Pflanzen. Ein Affe spielt Gitarre auf einer H√§ngematte.",
    words: [
      { pt: "Sol", de: "Sonne", tip: "Die Sonne hat ein Gesicht ‚Äì SOL l√§chelt" },
      { pt: "Chuva", de: "Regen", tip: "Pl√∂tzlich CHUVA ‚Äì der Affe versteckt sich" },
      { pt: "Flor", de: "Blume", tip: "Eine riesige FLOR w√§chst vor deinen Augen" },
      { pt: "Verde", de: "Gr√ºn", tip: "Alles ist VERDE ‚Äì sogar der Affe" },
      { pt: "√Årvore", de: "Baum", tip: "Eine √ÅRVORE tanzt im Wind" },
    ],
  },
  {
    room: "üöó Garage (Garagem)",
    scene:
      "Ein gelbes Taxi mit Fl√ºgeln. Der Motor spielt Bossa Nova.",
    words: [
      { pt: "Carro", de: "Auto", tip: "Das fliegende CARRO hebt ab!" },
      { pt: "Rua", de: "Stra√üe", tip: "Die RUA vor der Garage ist aus Gold" },
      { pt: "Ir", de: "Gehen", tip: "Das Taxi sagt: 'Vamos IR!' ‚Äì Los geht's!" },
      { pt: "R√°pido", de: "Schnell", tip: "Das Taxi fliegt R√ÅPIDO durch die Wolken" },
      { pt: "Devagar", de: "Langsam", tip: "Du bremst ‚Äì DEVAGAR! Gem√ºtlich." },
    ],
  },
  {
    room: "üè™ Laden (Loja)",
    scene:
      "Ein Markt voller Farben. Eine alte Frau verkauft sprechende Fr√ºchte.",
    words: [
      { pt: "Dinheiro", de: "Geld", tip: "DINHEIRO regnet vom Dach des Ladens" },
      { pt: "Comprar", de: "Kaufen", tip: "Du willst alles COMPRAR ‚Äì die Fr√ºchte rufen dich!" },
      { pt: "Barato", de: "Billig", tip: "Die Ananas schreit: 'BARATO! Nimm mich!'" },
      { pt: "Caro", de: "Teuer", tip: "Die Mango tr√§gt Goldketten ‚Äì CARO!" },
      { pt: "Muito", de: "Viel/Sehr", tip: "MUITO Fr√ºchte! Der Laden platzt!" },
    ],
  },
  {
    room: "üé≠ Theater (Teatro)",
    scene:
      "Scheinwerfer gehen an. Du stehst auf der B√ºhne vor tausend Papageien.",
    words: [
      { pt: "Falar", de: "Sprechen", tip: "Du musst FALAR ‚Äì die Papageien warten!" },
      { pt: "Entender", de: "Verstehen", tip: "Die Papageien nicken ‚Äì sie ENTENDER!" },
      { pt: "Dif√≠cil", de: "Schwierig", tip: "Die Rede ist DIF√çCIL ‚Äì du stotterst" },
      { pt: "F√°cil", de: "Einfach", tip: "Dann wird's F√ÅCIL ‚Äì du sprichst flie√üend!" },
      { pt: "Tentar", de: "Versuchen", tip: "Du musst es TENTAR ‚Äì trau dich!" },
    ],
  },
  {
    room: "üåÖ Dachterrasse (Terra√ßo)",
    scene:
      "Sonnenuntergang √ºber Rio. Die Christus-Statue winkt dir zu.",
    words: [
      { pt: "Amor", de: "Liebe", tip: "Christus formt ein Herz ‚Äì AMOR!" },
      { pt: "Vida", de: "Leben", tip: "Du atmest tief ein ‚Äì das ist VIDA!" },
      { pt: "Feliz", de: "Gl√ºcklich", tip: "Du l√§chelst √ºber ganz Rio ‚Äì FELIZ!" },
      { pt: "Sempre", de: "Immer", tip: "Die Sonne geht SEMPRE unter ‚Äì jeden Tag" },
      { pt: "Agora", de: "Jetzt", tip: "AGORA ist der Moment ‚Äì genie√ü es!" },
    ],
  },
];

const SLANG_PHRASES = [
  {
    phrase: "E a√≠?",
    meaning: "Und? / Was geht?",
    tone: "Super l√§ssig, unter Freunden",
    example: "E a√≠, mano? Tudo bem? ‚Äì Ey, Alter, alles klar?",
  },
  {
    phrase: "Beleza!",
    meaning: "Alles klar! / Cool!",
    tone: "Zustimmend, entspannt",
    example: "Vamos √†s 8? ‚Äì Beleza! ‚Üí Gehen wir um 8? ‚Äì Alles klar!",
  },
  {
    phrase: "Cara / Mano",
    meaning: "Alter / Typ / Kumpel",
    tone: "Informell, wie 'Dude' auf Englisch",
    example: "Cara, tu n√£o vai acreditar! ‚Äì Alter, du glaubst es nicht!",
  },
  {
    phrase: "T√° ligado?",
    meaning: "Verstehst du? / Wei√üt du?",
    tone: "Stra√üensprache, jugendlich",
    example: "Ele √© gente boa, t√° ligado? ‚Äì Er ist cool, wei√üt du?",
  },
  {
    phrase: "Valeu!",
    meaning: "Danke! / Tsch√ºss!",
    tone: "Sehr informell, unter Freunden",
    example: "Valeu, mano! Falou! ‚Äì Danke, Alter! Bis dann!",
  },
  {
    phrase: "Que massa!",
    meaning: "Wie geil! / Wie cool!",
    tone: "Begeistert, positiv",
    example: "Ganhei um carro novo! ‚Äì Que massa! ‚Üí Ich hab ein neues Auto! ‚Äì Wie geil!",
  },
  {
    phrase: "T√¥ nem a√≠",
    meaning: "Ist mir egal / Juckt mich nicht",
    tone: "Gleichg√ºltig, kann frech wirken",
    example: "Ele t√° falando mal de mim. ‚Äì T√¥ nem a√≠. ‚Üí Er redet schlecht √ºber mich. ‚Äì Juckt mich nicht.",
  },
  {
    phrase: "P√¥!",
    meaning: "Mensch! / Ach Mann!",
    tone: "Frustriert oder √ºberrascht",
    example: "P√¥, esqueci a carteira! ‚Äì Mensch, ich hab die Geldb√∂rse vergessen!",
  },
  {
    phrase: "Saudade",
    meaning: "Sehnsucht / Vermissen (un√ºbersetzbar!)",
    tone: "Emotional, tiefgr√ºndig",
    example: "T√¥ com saudade de voc√™. ‚Äì Ich vermisse dich so sehr.",
  },
  {
    phrase: "Gata / Gato",
    meaning: "H√ºbsche Frau / Hei√üer Typ (w√∂rtl. Katze)",
    tone: "Flirty, Kompliment",
    example: "Olha aquela gata! ‚Äì Schau dir die H√ºbsche an!",
  },
  {
    phrase: "Falou!",
    meaning: "Abgemacht! / Tsch√ºss!",
    tone: "L√§ssig, zum Abschied",
    example: "Amanh√£ √†s 10, falou! ‚Äì Morgen um 10, abgemacht!",
  },
  {
    phrase: "Caramba!",
    meaning: "Wow! / Verdammt!",
    tone: "√úberrascht, nicht vulg√§r",
    example: "Caramba, que jogo! ‚Äì Wow, was f√ºr ein Spiel!",
  },
  {
    phrase: "Pode crer!",
    meaning: "Stimmt! / Ja, voll!",
    tone: "Zustimmend, best√§tigend",
    example: "Essa pizza √© a melhor. ‚Äì Pode crer! ‚Üí Diese Pizza ist die beste. ‚Äì Ja, voll!",
  },
  {
    phrase: "T√¥ de boa",
    meaning: "Mir geht's gut / Ich chill",
    tone: "Entspannt, relaxed",
    example: "Quer sair? ‚Äì N√£o, t√¥ de boa. ‚Üí Willst du rausgehen? ‚Äì Nee, ich chill.",
  },
  {
    phrase: "Merm√£o",
    meaning: "Bruder (meu irm√£o verk√ºrzt)",
    tone: "Sehr informell, Rio-Slang",
    example: "Merm√£o, para com isso! ‚Äì Bruder, h√∂r auf damit!",
  },
  {
    phrase: "Suave",
    meaning: "Easy / Entspannt / Kein Problem",
    tone: "Cool, gelassen",
    example: "Deu pra fazer? ‚Äì Suave! ‚Üí Hast du's geschafft? ‚Äì Easy!",
  },
  {
    phrase: "Partiu!",
    meaning: "Los geht's! / Auf geht's!",
    tone: "Motivierend, Aufbruch",
    example: "Partiu praia! ‚Äì Ab an den Strand!",
  },
  {
    phrase: "Vacilou",
    meaning: "Du hast Mist gebaut / Fail",
    tone: "Vorwurfsvoll, aber oft spielerisch",
    example: "Esqueceu o anivers√°rio dela? Vacilou, hein! ‚Äì Ihren Geburtstag vergessen? Fail, ey!",
  },
  {
    phrase: "Bora!",
    meaning: "Los! / Komm! (von 'vamos embora')",
    tone: "Energisch, auffordern",
    example: "Bora almo√ßar? ‚Äì Komm, Mittagessen?",
  },
  {
    phrase: "Zoar",
    meaning: "Verarschen / Rumalbern",
    tone: "Spa√üig, unter Kumpels",
    example: "Para de me zoar! ‚Äì H√∂r auf mich zu verarschen!",
  },
];

const QUIZ_QUESTIONS = [
  {
    q: "Wie sagt man 'Guten Morgen' auf Portugiesisch?",
    options: ["Boa noite", "Bom dia", "Boa tarde", "Bom tempo"],
    correct: 1,
    category: "Begr√º√üungen",
    explanation: "'Bom dia' = Guten Morgen. 'Boa tarde' = Guten Nachmittag. 'Boa noite' = Guten Abend/Gute Nacht.",
  },
  {
    q: "Was bedeutet 'Obrigado'?",
    options: ["Bitte", "Entschuldigung", "Danke", "Tsch√ºss"],
    correct: 2,
    category: "Grundvokabular",
    explanation: "'Obrigado' (m√§nnlich) / 'Obrigada' (weiblich) = Danke. Ein Mann sagt immer 'obrigado', eine Frau 'obrigada'.",
  },
  {
    q: "√úbersetze: 'Eu quero √°gua'",
    options: ["Ich brauche Hilfe", "Ich will Wasser", "Ich habe Hunger", "Ich trinke Kaffee"],
    correct: 1,
    category: "Grunds√§tze",
    explanation: "'Eu' = Ich, 'quero' = will, '√°gua' = Wasser. 'Querer' ist ein wichtiges Verb!",
  },
  {
    q: "Welches Wort bedeutet 'Haus'?",
    options: ["Carro", "Casa", "Cama", "Caf√©"],
    correct: 1,
    category: "Grundvokabular",
    explanation: "'Casa' = Haus. 'Carro' = Auto, 'Cama' = Bett, 'Caf√©' = Kaffee.",
  },
  {
    q: "Was bedeutet 'E a√≠?' im Slang?",
    options: ["Wohin gehst du?", "Was geht?", "Wie hei√üt du?", "Wo bist du?"],
    correct: 1,
    category: "Slang",
    explanation: "'E a√≠?' ist super informell und bedeutet 'Was geht?' oder 'Und?' ‚Äì wird st√§ndig benutzt!",
  },
  {
    q: "Wie z√§hlt man auf Portugiesisch: 1, 2, 3?",
    options: ["uno, dos, tres", "um, dois, tr√™s", "en, to, tre", "bir, iki, √º√ß"],
    correct: 1,
    category: "Zahlen",
    explanation: "'Um, dois, tr√™s' ‚Äì Vorsicht, nicht mit Spanisch verwechseln! (uno, dos, tres).",
  },
  {
    q: "'Eu sou da Alemanha' bedeutet:",
    options: ["Ich liebe Deutschland", "Ich bin aus Deutschland", "Ich fahre nach Deutschland", "Ich kenne Deutschland"],
    correct: 1,
    category: "Selbstvorstellung",
    explanation: "'Eu sou' = Ich bin, 'da Alemanha' = aus Deutschland. Perfekt um sich vorzustellen!",
  },
  {
    q: "Was ist die korrekte Verneinung von 'Eu falo portugu√™s'?",
    options: ["Eu no falo portugu√™s", "Eu n√£o falo portugu√™s", "Eu nem falo portugu√™s", "Eu nunca falo portugu√™s"],
    correct: 1,
    category: "Grammatik",
    explanation: "'N√£o' ist die Standard-Verneinung. Es steht VOR dem Verb: 'Eu n√£o falo' = Ich spreche nicht.",
  },
  {
    q: "Was bedeutet 'Saudade'?",
    options: ["Gesundheit", "Sehnsucht/Vermissen", "Freude", "Freiheit"],
    correct: 1,
    category: "Kultur & Vokabular",
    explanation: "'Saudade' ist DAS portugiesische Wort schlechthin ‚Äì ein tiefes Gef√ºhl des Vermissens. Es gibt keine exakte √úbersetzung!",
  },
  {
    q: "Vervollst√§ndige: 'Muito _____ te conhecer' (Freut mich dich kennenzulernen)",
    options: ["bom", "bem", "prazer", "feliz"],
    correct: 2,
    category: "Redewendungen",
    explanation: "'Muito prazer' = Sehr erfreut / Freut mich. Eine der wichtigsten Redewendungen beim Kennenlernen!",
  },
];

const CONVERSATION_STARTERS = [
  {
    level: "Anf√§nger (A1)",
    locked: true,
    title: "Primeiro Papo ‚Äì Erstes Gespr√§ch",
    description: "Erst die Basics lernen! Nach dem Quiz freigeschaltet.",
  },
];

// ‚îÄ‚îÄ‚îÄ COMPONENTS ‚îÄ‚îÄ‚îÄ

function Nav({ active, setActive }) {
  return (
    <nav style={{
      position: "sticky", top: 0, zIndex: 50,
      background: "linear-gradient(135deg, #0f0f0f 0%, #1a1a2e 100%)",
      borderBottom: "1px solid rgba(0, 255, 135, 0.15)",
      backdropFilter: "blur(12px)",
      padding: "0 16px",
    }}>
      <div style={{
        maxWidth: 1200, margin: "0 auto",
        display: "flex", gap: 4, overflowX: "auto",
        padding: "12px 0",
        scrollbarWidth: "none",
      }}>
        {SECTIONS.map((s) => (
          <button
            key={s.id}
            onClick={() => setActive(s.id)}
            style={{
              padding: "10px 18px",
              borderRadius: 12,
              border: active === s.id ? "1px solid #00ff87" : "1px solid transparent",
              background: active === s.id
                ? "linear-gradient(135deg, rgba(0,255,135,0.15), rgba(0,200,100,0.08))"
                : "transparent",
              color: active === s.id ? "#00ff87" : "#888",
              fontFamily: "'DM Sans', sans-serif",
              fontSize: 14,
              fontWeight: 600,
              cursor: "pointer",
              transition: "all 0.3s ease",
              whiteSpace: "nowrap",
              letterSpacing: "0.02em",
            }}
          >
            <span style={{ marginRight: 6 }}>{s.icon}</span>
            {s.label}
          </button>
        ))}
      </div>
    </nav>
  );
}

function PlanSection() {
  const [openPhase, setOpenPhase] = useState(0);
  return (
    <div style={{ animation: "fadeUp 0.6s ease" }}>
      <div style={{ textAlign: "center", marginBottom: 48 }}>
        <h2 style={{
          fontFamily: "'Playfair Display', serif",
          fontSize: "clamp(28px, 5vw, 42px)",
          fontWeight: 700,
          color: "#fff",
          marginBottom: 8,
        }}>
          {FLUENCY_PLAN.title}
        </h2>
        <p style={{
          fontFamily: "'DM Sans', sans-serif",
          color: "#00ff87",
          fontSize: 16,
          letterSpacing: "0.08em",
          textTransform: "uppercase",
        }}>
          {FLUENCY_PLAN.subtitle}
        </p>
      </div>
      <div style={{ display: "flex", flexDirection: "column", gap: 20 }}>
        {FLUENCY_PLAN.phases.map((phase, pi) => (
          <div key={pi} style={{
            background: "linear-gradient(145deg, rgba(26,26,46,0.9), rgba(15,15,15,0.95))",
            border: `1px solid ${openPhase === pi ? phase.color + "66" : "rgba(255,255,255,0.06)"}`,
            borderRadius: 20,
            overflow: "hidden",
            transition: "all 0.4s ease",
          }}>
            <button
              onClick={() => setOpenPhase(openPhase === pi ? -1 : pi)}
              style={{
                width: "100%", padding: "24px 28px",
                display: "flex", justifyContent: "space-between", alignItems: "center",
                background: "none", border: "none", cursor: "pointer",
              }}
            >
              <div style={{ textAlign: "left" }}>
                <span style={{
                  fontFamily: "'DM Sans', sans-serif",
                  fontSize: 12, fontWeight: 700,
                  color: phase.color,
                  letterSpacing: "0.1em",
                  textTransform: "uppercase",
                }}>
                  {phase.weeks}
                </span>
                <h3 style={{
                  fontFamily: "'Playfair Display', serif",
                  fontSize: "clamp(20px, 3vw, 26px)",
                  color: "#fff", fontWeight: 600, marginTop: 4,
                }}>
                  {phase.name}
                </h3>
              </div>
              <span style={{
                fontSize: 24, color: phase.color,
                transform: openPhase === pi ? "rotate(180deg)" : "rotate(0)",
                transition: "transform 0.3s ease",
              }}>
                ‚ñæ
              </span>
            </button>
            {openPhase === pi && (
              <div style={{
                padding: "0 28px 28px",
                display: "grid",
                gridTemplateColumns: "repeat(auto-fit, minmax(260px, 1fr))",
                gap: 16,
                animation: "fadeUp 0.4s ease",
              }}>
                {phase.skills.map((skill, si) => (
                  <div key={si} style={{
                    background: "rgba(0,0,0,0.3)",
                    borderRadius: 14,
                    padding: 20,
                    border: "1px solid rgba(255,255,255,0.04)",
                  }}>
                    <div style={{
                      fontSize: 28, marginBottom: 8,
                    }}>
                      {skill.icon}
                    </div>
                    <h4 style={{
                      fontFamily: "'DM Sans', sans-serif",
                      fontSize: 15, fontWeight: 700,
                      color: phase.color, marginBottom: 12,
                    }}>
                      {skill.name}
                    </h4>
                    {skill.tasks.map((task, ti) => (
                      <div key={ti} style={{
                        display: "flex", gap: 8, marginBottom: 10,
                        alignItems: "flex-start",
                      }}>
                        <span style={{
                          color: phase.color, fontSize: 10, marginTop: 6,
                          flexShrink: 0,
                        }}>‚óè</span>
                        <p style={{
                          fontFamily: "'DM Sans', sans-serif",
                          fontSize: 13, color: "#ccc", lineHeight: 1.6,
                        }}>
                          {task}
                        </p>
                      </div>
                    ))}
                  </div>
                ))}
              </div>
            )}
          </div>
        ))}
      </div>
    </div>
  );
}

function PalaceSection() {
  const [activeRoom, setActiveRoom] = useState(0);
  const [revealedWords, setRevealedWords] = useState({});

  const toggleWord = (roomIdx, wordIdx) => {
    const key = `${roomIdx}-${wordIdx}`;
    setRevealedWords((prev) => ({ ...prev, [key]: !prev[key] }));
  };

  return (
    <div style={{ animation: "fadeUp 0.6s ease" }}>
      <div style={{ textAlign: "center", marginBottom: 40 }}>
        <h2 style={{
          fontFamily: "'Playfair Display', serif",
          fontSize: "clamp(28px, 5vw, 42px)",
          fontWeight: 700, color: "#fff", marginBottom: 8,
        }}>
          üèõÔ∏è Dein Ged√§chtnispalast
        </h2>
        <p style={{
          fontFamily: "'DM Sans', sans-serif",
          color: "#aaa", fontSize: 15, maxWidth: 600, margin: "0 auto",
        }}>
          Geh durch 10 R√§ume. Jeder Raum hat eine verr√ºckte Szene und 5 W√∂rter.
          Klick auf ein Wort um den Ged√§chtnistrick zu sehen.
        </p>
      </div>

      {/* Room tabs */}
      <div style={{
        display: "flex", gap: 6, overflowX: "auto",
        paddingBottom: 16, marginBottom: 24,
        scrollbarWidth: "none",
      }}>
        {MEMORY_PALACE.map((room, i) => (
          <button
            key={i}
            onClick={() => setActiveRoom(i)}
            style={{
              padding: "10px 16px",
              borderRadius: 10,
              border: activeRoom === i ? "1px solid #f59e0b" : "1px solid rgba(255,255,255,0.08)",
              background: activeRoom === i
                ? "linear-gradient(135deg, rgba(245,158,11,0.2), rgba(245,158,11,0.05))"
                : "rgba(26,26,46,0.6)",
              color: activeRoom === i ? "#f59e0b" : "#777",
              fontFamily: "'DM Sans', sans-serif",
              fontSize: 13, fontWeight: 600, cursor: "pointer",
              whiteSpace: "nowrap", transition: "all 0.3s",
            }}
          >
            Raum {i + 1}
          </button>
        ))}
      </div>

      {/* Active room */}
      <div style={{
        background: "linear-gradient(145deg, rgba(26,26,46,0.95), rgba(15,15,15,0.98))",
        border: "1px solid rgba(245,158,11,0.2)",
        borderRadius: 24, padding: "clamp(20px, 4vw, 36px)",
      }}>
        <h3 style={{
          fontFamily: "'Playfair Display', serif",
          fontSize: "clamp(22px, 3.5vw, 30px)",
          color: "#f59e0b", marginBottom: 8,
        }}>
          {MEMORY_PALACE[activeRoom].room}
        </h3>
        <p style={{
          fontFamily: "'DM Sans', sans-serif",
          fontSize: 15, color: "#ddd", lineHeight: 1.7,
          marginBottom: 28,
          padding: "16px 20px",
          background: "rgba(245,158,11,0.06)",
          borderRadius: 14,
          borderLeft: "3px solid #f59e0b",
          fontStyle: "italic",
        }}>
          üé¨ {MEMORY_PALACE[activeRoom].scene}
        </p>
        <div style={{
          display: "grid",
          gridTemplateColumns: "repeat(auto-fit, minmax(220px, 1fr))",
          gap: 14,
        }}>
          {MEMORY_PALACE[activeRoom].words.map((w, wi) => {
            const key = `${activeRoom}-${wi}`;
            const revealed = revealedWords[key];
            return (
              <button
                key={wi}
                onClick={() => toggleWord(activeRoom, wi)}
                style={{
                  background: revealed
                    ? "linear-gradient(135deg, rgba(245,158,11,0.15), rgba(245,158,11,0.05))"
                    : "rgba(0,0,0,0.3)",
                  border: revealed ? "1px solid rgba(245,158,11,0.3)" : "1px solid rgba(255,255,255,0.06)",
                  borderRadius: 14, padding: 18,
                  cursor: "pointer", textAlign: "left",
                  transition: "all 0.3s ease",
                }}
              >
                <div style={{
                  fontFamily: "'Playfair Display', serif",
                  fontSize: 22, fontWeight: 700,
                  color: "#f59e0b", marginBottom: 4,
                }}>
                  {w.pt}
                </div>
                <div style={{
                  fontFamily: "'DM Sans', sans-serif",
                  fontSize: 13, color: "#aaa", marginBottom: revealed ? 12 : 0,
                }}>
                  = {w.de}
                </div>
                {revealed && (
                  <div style={{
                    fontFamily: "'DM Sans', sans-serif",
                    fontSize: 12, color: "#f59e0b",
                    lineHeight: 1.6,
                    borderTop: "1px solid rgba(245,158,11,0.15)",
                    paddingTop: 10,
                    animation: "fadeUp 0.3s ease",
                  }}>
                    üí° {w.tip}
                  </div>
                )}
              </button>
            );
          })}
        </div>
        <p style={{
          fontFamily: "'DM Sans', sans-serif",
          fontSize: 12, color: "#666", textAlign: "center",
          marginTop: 20,
        }}>
          Fortschritt: {activeRoom + 1}/10 R√§ume ¬∑ {(activeRoom + 1) * 5}/50 W√∂rter
        </p>
      </div>
    </div>
  );
}

function SlangSection() {
  const [expandedIdx, setExpandedIdx] = useState(null);
  return (
    <div style={{ animation: "fadeUp 0.6s ease" }}>
      <div style={{ textAlign: "center", marginBottom: 40 }}>
        <h2 style={{
          fontFamily: "'Playfair Display', serif",
          fontSize: "clamp(28px, 5vw, 42px)",
          fontWeight: 700, color: "#fff", marginBottom: 8,
        }}>
          üó£Ô∏è 20 G√≠rias Brasileiras
        </h2>
        <p style={{
          fontFamily: "'DM Sans', sans-serif",
          color: "#aaa", fontSize: 15, maxWidth: 550, margin: "0 auto",
        }}>
          Slang, den echte Brasilianer jeden Tag benutzen. Kein Lehrbuch bringt dir das bei.
        </p>
      </div>
      <div style={{
        display: "grid",
        gridTemplateColumns: "repeat(auto-fit, minmax(340px, 1fr))",
        gap: 12,
      }}>
        {SLANG_PHRASES.map((s, i) => (
          <button
            key={i}
            onClick={() => setExpandedIdx(expandedIdx === i ? null : i)}
            style={{
              background: expandedIdx === i
                ? "linear-gradient(145deg, rgba(139,92,246,0.12), rgba(139,92,246,0.04))"
                : "rgba(26,26,46,0.6)",
              border: expandedIdx === i
                ? "1px solid rgba(139,92,246,0.3)"
                : "1px solid rgba(255,255,255,0.05)",
              borderRadius: 16, padding: "18px 22px",
              cursor: "pointer", textAlign: "left",
              transition: "all 0.3s ease", width: "100%",
            }}
          >
            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
              <div>
                <span style={{
                  fontFamily: "'DM Sans', sans-serif",
                  fontSize: 11, fontWeight: 700,
                  color: "#8b5cf6", letterSpacing: "0.05em",
                }}>
                  #{String(i + 1).padStart(2, "0")}
                </span>
                <h4 style={{
                  fontFamily: "'Playfair Display', serif",
                  fontSize: 20, color: "#fff",
                  fontWeight: 600, marginTop: 2,
                }}>
                  ‚Äû{s.phrase}"
                </h4>
              </div>
              <span style={{
                fontSize: 12, color: "#8b5cf6",
                transform: expandedIdx === i ? "rotate(180deg)" : "rotate(0)",
                transition: "transform 0.3s",
              }}>‚ñæ</span>
            </div>
            <p style={{
              fontFamily: "'DM Sans', sans-serif",
              fontSize: 13, color: "#aaa", marginTop: 4,
            }}>
              ‚Üí {s.meaning}
            </p>
            {expandedIdx === i && (
              <div style={{ marginTop: 14, animation: "fadeUp 0.3s ease" }}>
                <div style={{
                  background: "rgba(139,92,246,0.08)",
                  borderRadius: 10, padding: 14,
                  marginBottom: 10,
                }}>
                  <span style={{
                    fontFamily: "'DM Sans', sans-serif",
                    fontSize: 11, fontWeight: 700,
                    color: "#8b5cf6", textTransform: "uppercase",
                    letterSpacing: "0.08em",
                  }}>Ton / Stimmung</span>
                  <p style={{
                    fontFamily: "'DM Sans', sans-serif",
                    fontSize: 13, color: "#ccc", marginTop: 4,
                  }}>
                    {s.tone}
                  </p>
                </div>
                <div style={{
                  background: "rgba(0,0,0,0.3)",
                  borderRadius: 10, padding: 14,
                  borderLeft: "3px solid #8b5cf6",
                }}>
                  <span style={{
                    fontFamily: "'DM Sans', sans-serif",
                    fontSize: 11, fontWeight: 700,
                    color: "#8b5cf6", textTransform: "uppercase",
                    letterSpacing: "0.08em",
                  }}>Beispiel</span>
                  <p style={{
                    fontFamily: "'DM Sans', sans-serif",
                    fontSize: 13, color: "#ddd", marginTop: 4,
                    lineHeight: 1.7, fontStyle: "italic",
                  }}>
                    {s.example}
                  </p>
                </div>
              </div>
            )}
          </button>
        ))}
      </div>
    </div>
  );
}

function QuizSection({ onComplete }) {
  const [currentQ, setCurrentQ] = useState(0);
  const [answers, setAnswers] = useState([]);
  const [selected, setSelected] = useState(null);
  const [showResult, setShowResult] = useState(false);
  const [showAnalysis, setShowAnalysis] = useState(false);

  const handleSelect = (idx) => {
    if (selected !== null) return;
    setSelected(idx);
    const newAnswers = [...answers, {
      question: currentQ,
      chosen: idx,
      correct: QUIZ_QUESTIONS[currentQ].correct,
      isCorrect: idx === QUIZ_QUESTIONS[currentQ].correct,
      category: QUIZ_QUESTIONS[currentQ].category,
    }];
    setAnswers(newAnswers);

    setTimeout(() => {
      if (currentQ < QUIZ_QUESTIONS.length - 1) {
        setCurrentQ(currentQ + 1);
        setSelected(null);
      } else {
        setShowResult(true);
        onComplete(newAnswers);
      }
    }, 1800);
  };

  const score = answers.filter((a) => a.isCorrect).length;

  if (showResult) {
    const categoryScores = {};
    answers.forEach((a) => {
      if (!categoryScores[a.category]) categoryScores[a.category] = { total: 0, correct: 0 };
      categoryScores[a.category].total++;
      if (a.isCorrect) categoryScores[a.category].correct++;
    });

    const weakAreas = Object.entries(categoryScores)
      .filter(([, v]) => v.correct < v.total)
      .sort((a, b) => (a[1].correct / a[1].total) - (b[1].correct / b[1].total));

    return (
      <div style={{ animation: "fadeUp 0.6s ease" }}>
        <div style={{
          textAlign: "center",
          background: "linear-gradient(145deg, rgba(26,26,46,0.95), rgba(15,15,15,0.98))",
          border: "1px solid rgba(0,255,135,0.2)",
          borderRadius: 24, padding: "clamp(28px, 5vw, 48px)",
          marginBottom: 32,
        }}>
          <div style={{
            fontSize: 64, marginBottom: 16,
          }}>
            {score >= 8 ? "üèÜ" : score >= 5 ? "üí™" : "üìö"}
          </div>
          <h2 style={{
            fontFamily: "'Playfair Display', serif",
            fontSize: "clamp(28px, 4vw, 38px)",
            color: "#fff", fontWeight: 700,
          }}>
            {score}/10 richtig!
          </h2>
          <p style={{
            fontFamily: "'DM Sans', sans-serif",
            fontSize: 16, color: "#00ff87", marginTop: 8,
          }}>
            {score >= 8
              ? "Incr√≠vel! Du bist ein Naturtalent!"
              : score >= 5
              ? "Bom trabalho! Solide Basis!"
              : "N√£o desiste! Jeder f√§ngt mal an!"}
          </p>
        </div>

        <button
          onClick={() => setShowAnalysis(!showAnalysis)}
          style={{
            width: "100%", padding: "18px 24px",
            background: "linear-gradient(135deg, rgba(239,68,68,0.15), rgba(239,68,68,0.05))",
            border: "1px solid rgba(239,68,68,0.25)",
            borderRadius: 16, cursor: "pointer",
            marginBottom: 20,
            display: "flex", justifyContent: "space-between", alignItems: "center",
          }}
        >
          <h3 style={{
            fontFamily: "'DM Sans', sans-serif",
            fontSize: 16, fontWeight: 700, color: "#ef4444",
          }}>
            üîç Schwachstellen-Analyse
          </h3>
          <span style={{
            color: "#ef4444", fontSize: 14,
            transform: showAnalysis ? "rotate(180deg)" : "rotate(0)",
            transition: "transform 0.3s",
          }}>‚ñæ</span>
        </button>

        {showAnalysis && (
          <div style={{ animation: "fadeUp 0.4s ease" }}>
            {weakAreas.length === 0 ? (
              <div style={{
                background: "rgba(0,255,135,0.06)",
                border: "1px solid rgba(0,255,135,0.15)",
                borderRadius: 16, padding: 24, textAlign: "center",
              }}>
                <p style={{
                  fontFamily: "'DM Sans', sans-serif",
                  fontSize: 15, color: "#00ff87",
                }}>
                  Perfekt! Keine Schwachstellen gefunden. Du bist bereit f√ºr Phase 2!
                </p>
              </div>
            ) : (
              <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
                {weakAreas.map(([cat, data], i) => (
                  <div key={i} style={{
                    background: "rgba(26,26,46,0.8)",
                    border: "1px solid rgba(239,68,68,0.15)",
                    borderRadius: 16, padding: 20,
                  }}>
                    <div style={{
                      display: "flex", justifyContent: "space-between",
                      alignItems: "center", marginBottom: 12,
                    }}>
                      <h4 style={{
                        fontFamily: "'DM Sans', sans-serif",
                        fontSize: 15, fontWeight: 700, color: "#ef4444",
                      }}>
                        ‚ö†Ô∏è {cat}
                      </h4>
                      <span style={{
                        fontFamily: "'DM Sans', sans-serif",
                        fontSize: 13, color: "#888",
                      }}>
                        {data.correct}/{data.total} richtig
                      </span>
                    </div>
                    <div style={{
                      height: 6, borderRadius: 3,
                      background: "rgba(255,255,255,0.06)",
                      overflow: "hidden",
                    }}>
                      <div style={{
                        height: "100%", borderRadius: 3,
                        background: data.correct === 0
                          ? "#ef4444"
                          : "linear-gradient(90deg, #ef4444, #f59e0b)",
                        width: `${(data.correct / data.total) * 100}%`,
                        transition: "width 1s ease",
                      }} />
                    </div>
                    <p style={{
                      fontFamily: "'DM Sans', sans-serif",
                      fontSize: 13, color: "#aaa", marginTop: 10,
                      lineHeight: 1.6,
                    }}>
                      {cat === "Begr√º√üungen" && "Tipp: √úbe die drei Tageszeiten ‚Äì manh√£ (Morgen), tarde (Nachmittag), noite (Abend). Die Begr√º√üungen folgen dem gleichen Muster!"}
                      {cat === "Grundvokabular" && "Tipp: Geh nochmal durch den Ged√§chtnispalast! Die verr√ºckten Szenen helfen dir, die W√∂rter sofort zu erinnern."}
                      {cat === "Grunds√§tze" && "Tipp: Lerne die Struktur 'Eu + Verb + Objekt'. Auf Portugiesisch ist die Satzstellung √§hnlich wie im Deutschen!"}
                      {cat === "Slang" && "Tipp: Slang kommt mit der Zeit. Schau brasilianische YouTuber und achte auf die informelle Sprache."}
                      {cat === "Zahlen" && "Tipp: Verwechsle Portugiesisch nicht mit Spanisch! √úbe die Zahlen 1-20 jeden Tag beim Treppensteigen."}
                      {cat === "Selbstvorstellung" && "Tipp: √úbe 'Eu sou...' (Ich bin...) + 'Eu sou da/de...' (Ich bin aus...) ‚Äì das brauchst du st√§ndig!"}
                      {cat === "Grammatik" && "Tipp: Die Verneinung ist simpel ‚Äì 'n√£o' vor das Verb! 'Eu n√£o sei' (Ich wei√ü nicht), 'Eu n√£o quero' (Ich will nicht)."}
                      {cat === "Kultur & Vokabular" && "Tipp: 'Saudade' ist DIE portugiesische Emotion. H√∂r den Song 'Chega de Saudade' von Jo√£o Gilberto!"}
                      {cat === "Redewendungen" && "Tipp: Lerne feste Ausdr√ºcke als Bl√∂cke: 'Muito prazer', 'Com licen√ßa', 'Tudo bem?' ‚Äì nicht Wort f√ºr Wort!"}
                    </p>
                  </div>
                ))}
              </div>
            )}

            <div style={{ marginTop: 32 }}>
              <h3 style={{
                fontFamily: "'Playfair Display', serif",
                fontSize: 20, color: "#fff", fontWeight: 600, marginBottom: 16,
              }}>
                üìù Alle Antworten im Detail
              </h3>
              {answers.map((a, i) => (
                <div key={i} style={{
                  background: a.isCorrect ? "rgba(0,255,135,0.04)" : "rgba(239,68,68,0.04)",
                  border: `1px solid ${a.isCorrect ? "rgba(0,255,135,0.12)" : "rgba(239,68,68,0.12)"}`,
                  borderRadius: 14, padding: 18, marginBottom: 10,
                }}>
                  <div style={{ display: "flex", gap: 8, alignItems: "flex-start" }}>
                    <span style={{ fontSize: 18 }}>{a.isCorrect ? "‚úÖ" : "‚ùå"}</span>
                    <div>
                      <p style={{
                        fontFamily: "'DM Sans', sans-serif",
                        fontSize: 14, color: "#ddd", fontWeight: 600,
                      }}>
                        {QUIZ_QUESTIONS[i].q}
                      </p>
                      {!a.isCorrect && (
                        <p style={{
                          fontFamily: "'DM Sans', sans-serif",
                          fontSize: 13, color: "#ef4444", marginTop: 4,
                        }}>
                          Deine Antwort: {QUIZ_QUESTIONS[i].options[a.chosen]}
                        </p>
                      )}
                      <p style={{
                        fontFamily: "'DM Sans', sans-serif",
                        fontSize: 13, color: "#00ff87", marginTop: 2,
                      }}>
                        Richtig: {QUIZ_QUESTIONS[i].options[a.correct]}
                      </p>
                      <p style={{
                        fontFamily: "'DM Sans', sans-serif",
                        fontSize: 12, color: "#888", marginTop: 8,
                        lineHeight: 1.6,
                      }}>
                        {QUIZ_QUESTIONS[i].explanation}
                      </p>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        <button
          onClick={() => {
            setCurrentQ(0);
            setAnswers([]);
            setSelected(null);
            setShowResult(false);
            setShowAnalysis(false);
          }}
          style={{
            width: "100%", padding: 16, marginTop: 24,
            background: "linear-gradient(135deg, #00ff87, #00cc6a)",
            border: "none", borderRadius: 14, cursor: "pointer",
            fontFamily: "'DM Sans', sans-serif",
            fontSize: 15, fontWeight: 700, color: "#0f0f0f",
          }}
        >
          üîÑ Quiz wiederholen
        </button>
      </div>
    );
  }

  const q = QUIZ_QUESTIONS[currentQ];

  return (
    <div style={{ animation: "fadeUp 0.6s ease" }}>
      <div style={{ textAlign: "center", marginBottom: 32 }}>
        <h2 style={{
          fontFamily: "'Playfair Display', serif",
          fontSize: "clamp(28px, 5vw, 42px)",
          fontWeight: 700, color: "#fff", marginBottom: 8,
        }}>
          ‚úçÔ∏è Teste dein Wissen
        </h2>
        <p style={{
          fontFamily: "'DM Sans', sans-serif",
          color: "#aaa", fontSize: 15,
        }}>
          10 Fragen ‚Äì Finde heraus, wo du stehst
        </p>
      </div>

      {/* Progress bar */}
      <div style={{
        height: 4, borderRadius: 2,
        background: "rgba(255,255,255,0.06)",
        marginBottom: 32, overflow: "hidden",
      }}>
        <div style={{
          height: "100%", borderRadius: 2,
          background: "linear-gradient(90deg, #00ff87, #2dd4bf)",
          width: `${((currentQ) / QUIZ_QUESTIONS.length) * 100}%`,
          transition: "width 0.5s ease",
        }} />
      </div>

      <div style={{
        background: "linear-gradient(145deg, rgba(26,26,46,0.95), rgba(15,15,15,0.98))",
        border: "1px solid rgba(0,255,135,0.1)",
        borderRadius: 24, padding: "clamp(24px, 4vw, 40px)",
      }}>
        <div style={{
          display: "flex", justifyContent: "space-between",
          alignItems: "center", marginBottom: 24,
        }}>
          <span style={{
            fontFamily: "'DM Sans', sans-serif",
            fontSize: 12, fontWeight: 700,
            color: "#00ff87",
            letterSpacing: "0.1em",
            textTransform: "uppercase",
          }}>
            Frage {currentQ + 1}/10
          </span>
          <span style={{
            fontFamily: "'DM Sans', sans-serif",
            fontSize: 12, color: "#666",
            background: "rgba(255,255,255,0.04)",
            padding: "4px 12px", borderRadius: 8,
          }}>
            {q.category}
          </span>
        </div>

        <h3 style={{
          fontFamily: "'Playfair Display', serif",
          fontSize: "clamp(20px, 3vw, 26px)",
          color: "#fff", fontWeight: 600,
          marginBottom: 28, lineHeight: 1.4,
        }}>
          {q.q}
        </h3>

        <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
          {q.options.map((opt, oi) => {
            let bg = "rgba(0,0,0,0.3)";
            let border = "1px solid rgba(255,255,255,0.06)";
            let color = "#ccc";
            if (selected !== null) {
              if (oi === q.correct) {
                bg = "rgba(0,255,135,0.12)";
                border = "1px solid rgba(0,255,135,0.4)";
                color = "#00ff87";
              } else if (oi === selected && oi !== q.correct) {
                bg = "rgba(239,68,68,0.12)";
                border = "1px solid rgba(239,68,68,0.4)";
                color = "#ef4444";
              }
            }
            return (
              <button
                key={oi}
                onClick={() => handleSelect(oi)}
                disabled={selected !== null}
                style={{
                  padding: "16px 20px",
                  background: bg, border, borderRadius: 14,
                  cursor: selected !== null ? "default" : "pointer",
                  textAlign: "left",
                  transition: "all 0.3s ease",
                  display: "flex", alignItems: "center", gap: 14,
                }}
              >
                <span style={{
                  width: 30, height: 30, borderRadius: 8,
                  background: "rgba(255,255,255,0.04)",
                  display: "flex", alignItems: "center", justifyContent: "center",
                  fontFamily: "'DM Sans', sans-serif",
                  fontSize: 13, fontWeight: 700, color: "#666",
                  flexShrink: 0,
                }}>
                  {String.fromCharCode(65 + oi)}
                </span>
                <span style={{
                  fontFamily: "'DM Sans', sans-serif",
                  fontSize: 15, color, fontWeight: 500,
                }}>
                  {opt}
                </span>
              </button>
            );
          })}
        </div>

        {selected !== null && (
          <div style={{
            marginTop: 20, padding: 16,
            background: "rgba(0,255,135,0.04)",
            borderRadius: 12,
            borderLeft: "3px solid #00ff87",
            animation: "fadeUp 0.3s ease",
          }}>
            <p style={{
              fontFamily: "'DM Sans', sans-serif",
              fontSize: 13, color: "#aaa", lineHeight: 1.7,
            }}>
              üí° {q.explanation}
            </p>
          </div>
        )}
      </div>
    </div>
  );
}

function ConversaSection({ quizDone }) {
  const [messages, setMessages] = useState([]);
  const [input, setInput] = useState("");
  const [started, setStarted] = useState(false);
  const chatRef = useRef(null);

  const conversationFlow = [
    {
      bot: "E a√≠! Tudo bem? üòÑ\n(Ey! Alles klar?)",
      hint: "Antworte z.B. mit: 'Tudo bem!' oder 'Tudo bom!'",
    },
    {
      bot: "Que bom! Como √© seu nome?\n(Sch√∂n! Wie ist dein Name?)",
      hint: "Sag: 'Meu nome √© [dein Name]' oder einfach 'Eu sou [Name]'",
    },
    {
      bot: "Prazer, {name}! Voc√™ √© de onde?\n(Freut mich! Woher bist du?)",
      hint: "Antworte: 'Eu sou da Alemanha' (Ich bin aus Deutschland)",
    },
    {
      bot: "Da Alemanha? Que massa! üá©üá™ Eu sou do Brasil, de S√£o Paulo.\n(Aus Deutschland? Wie cool! Ich bin aus Brasilien, aus S√£o Paulo.)",
      hint: "Frag: 'Voc√™ gosta de S√£o Paulo?' (Magst du S√£o Paulo?)",
    },
    {
      bot: "Adoro S√£o Paulo! Tem muita coisa pra fazer. E voc√™, t√° estudando portugu√™s h√° quanto tempo?\n(Ich liebe SP! Es gibt viel zu tun. Und du, wie lange lernst du schon Portugiesisch?)",
      hint: "Sag: 'Comecei agora!' (Hab gerade angefangen!) oder 'Pouco tempo' (Nicht lange)",
    },
    {
      bot: "P√¥, mas t√° mandando bem! Continue assim! üí™ Valeu pela conversa!\n(Mensch, aber du machst das gut! Mach weiter so! Danke f√ºr das Gespr√§ch!)",
      hint: "Antworte: 'Valeu! Falou!' (Danke! Bis dann!)",
    },
  ];

  const startChat = () => {
    setStarted(true);
    setMessages([
      { from: "bot", text: conversationFlow[0].bot, hint: conversationFlow[0].hint },
    ]);
  };

  const sendMessage = () => {
    if (!input.trim()) return;
    const newMessages = [...messages, { from: "user", text: input }];

    const nextIdx = newMessages.filter((m) => m.from === "bot").length;
    if (nextIdx < conversationFlow.length) {
      let botText = conversationFlow[nextIdx].bot;
      if (botText.includes("{name}")) {
        const userName = input.replace(/meu nome √©|eu sou|me chamo/gi, "").trim() || "amigo";
        botText = botText.replace("{name}", userName);
      }
      setTimeout(() => {
        setMessages((prev) => [
          ...prev,
          { from: "bot", text: botText, hint: conversationFlow[nextIdx].hint },
        ]);
      }, 1000);
    }

    setMessages(newMessages);
    setInput("");
  };

  useEffect(() => {
    if (chatRef.current) {
      chatRef.current.scrollTop = chatRef.current.scrollHeight;
    }
  }, [messages]);

  return (
    <div style={{ animation: "fadeUp 0.6s ease" }}>
      <div style={{ textAlign: "center", marginBottom: 32 }}>
        <h2 style={{
          fontFamily: "'Playfair Display', serif",
          fontSize: "clamp(28px, 5vw, 42px)",
          fontWeight: 700, color: "#fff", marginBottom: 8,
        }}>
          üí¨ Conversa Di√°ria
        </h2>
        <p style={{
          fontFamily: "'DM Sans', sans-serif",
          color: "#aaa", fontSize: 15, maxWidth: 550, margin: "0 auto",
        }}>
          5-Minuten-Gespr√§ch mit einem virtuellen Brasilianer. Nat√ºrliche Sprache, echte G√≠rias.
        </p>
      </div>

      {!quizDone && !started ? (
        <div style={{
          textAlign: "center",
          background: "rgba(26,26,46,0.8)",
          border: "1px solid rgba(255,255,255,0.06)",
          borderRadius: 24, padding: 48,
        }}>
          <span style={{ fontSize: 48 }}>üîí</span>
          <h3 style={{
            fontFamily: "'Playfair Display', serif",
            fontSize: 22, color: "#fff", marginTop: 16,
          }}>
            Erst die Basics!
          </h3>
          <p style={{
            fontFamily: "'DM Sans', sans-serif",
            fontSize: 14, color: "#888", marginTop: 8,
          }}>
            Schlie√üe das Quiz ab, um die t√§gliche Konversation freizuschalten.
          </p>
        </div>
      ) : !started ? (
        <div style={{ textAlign: "center" }}>
          <button
            onClick={startChat}
            style={{
              padding: "18px 48px",
              background: "linear-gradient(135deg, #00ff87, #00cc6a)",
              border: "none", borderRadius: 16, cursor: "pointer",
              fontFamily: "'DM Sans', sans-serif",
              fontSize: 16, fontWeight: 700, color: "#0f0f0f",
              boxShadow: "0 0 40px rgba(0,255,135,0.2)",
            }}
          >
            üéôÔ∏è Conversa starten!
          </button>
        </div>
      ) : (
        <div style={{
          background: "linear-gradient(145deg, rgba(26,26,46,0.95), rgba(15,15,15,0.98))",
          border: "1px solid rgba(0,255,135,0.1)",
          borderRadius: 24, overflow: "hidden",
        }}>
          <div ref={chatRef} style={{
            height: 420, overflowY: "auto", padding: "24px",
            display: "flex", flexDirection: "column", gap: 16,
          }}>
            {messages.map((m, i) => (
              <div key={i}>
                <div style={{
                  display: "flex",
                  justifyContent: m.from === "user" ? "flex-end" : "flex-start",
                }}>
                  <div style={{
                    maxWidth: "80%",
                    padding: "14px 18px",
                    borderRadius: m.from === "user" ? "18px 18px 4px 18px" : "18px 18px 18px 4px",
                    background: m.from === "user"
                      ? "linear-gradient(135deg, #00ff87, #00cc6a)"
                      : "rgba(255,255,255,0.06)",
                    color: m.from === "user" ? "#0f0f0f" : "#ddd",
                    fontFamily: "'DM Sans', sans-serif",
                    fontSize: 14, lineHeight: 1.7,
                    whiteSpace: "pre-line",
                    fontWeight: m.from === "user" ? 600 : 400,
                  }}>
                    {m.from === "bot" && (
                      <span style={{
                        fontSize: 10, color: "#00ff87",
                        fontWeight: 700, letterSpacing: "0.05em",
                        display: "block", marginBottom: 4,
                      }}>
                        üáßüá∑ NATIVO
                      </span>
                    )}
                    {m.text}
                  </div>
                </div>
                {m.hint && (
                  <div style={{
                    marginTop: 8,
                    padding: "10px 14px",
                    background: "rgba(245,158,11,0.06)",
                    borderRadius: 10,
                    borderLeft: "2px solid #f59e0b",
                    maxWidth: "80%",
                  }}>
                    <p style={{
                      fontFamily: "'DM Sans', sans-serif",
                      fontSize: 12, color: "#f59e0b",
                    }}>
                      üí° {m.hint}
                    </p>
                  </div>
                )}
              </div>
            ))}
          </div>
          <div style={{
            padding: "16px 24px",
            borderTop: "1px solid rgba(255,255,255,0.06)",
            display: "flex", gap: 10,
          }}>
            <input
              value={input}
              onChange={(e) => setInput(e.target.value)}
              onKeyDown={(e) => e.key === "Enter" && sendMessage()}
              placeholder="Schreib auf Portugiesisch..."
              style={{
                flex: 1, padding: "14px 18px",
                background: "rgba(0,0,0,0.3)",
                border: "1px solid rgba(255,255,255,0.08)",
                borderRadius: 14, color: "#fff",
                fontFamily: "'DM Sans', sans-serif",
                fontSize: 14, outline: "none",
              }}
            />
            <button
              onClick={sendMessage}
              style={{
                padding: "14px 24px",
                background: "linear-gradient(135deg, #00ff87, #00cc6a)",
                border: "none", borderRadius: 14, cursor: "pointer",
                fontFamily: "'DM Sans', sans-serif",
                fontSize: 14, fontWeight: 700, color: "#0f0f0f",
              }}
            >
              Enviar ‚Üí
            </button>
          </div>
        </div>
      )}
    </div>
  );
}

// ‚îÄ‚îÄ‚îÄ MAIN APP ‚îÄ‚îÄ‚îÄ

export default function App() {
  const [activeSection, setActiveSection] = useState("plan");
  const [quizCompleted, setQuizCompleted] = useState(false);

  return (
    <div style={{
      minHeight: "100vh",
      background: "linear-gradient(180deg, #0a0a0a 0%, #0f0f1a 30%, #0a0a0a 100%)",
      color: "#fff",
    }}>
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@400;500;600;700&display=swap');
        @keyframes fadeUp {
          from { opacity: 0; transform: translateY(16px); }
          to { opacity: 1; transform: translateY(0); }
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(0,255,135,0.2); border-radius: 2px; }
        input::placeholder { color: #555; }
      `}</style>

      {/* Hero */}
      <header style={{
        padding: "clamp(40px, 8vw, 80px) 20px clamp(32px, 5vw, 48px)",
        textAlign: "center",
        position: "relative",
        overflow: "hidden",
      }}>
        <div style={{
          position: "absolute", top: -100, left: "50%", transform: "translateX(-50%)",
          width: 600, height: 600,
          background: "radial-gradient(circle, rgba(0,255,135,0.06) 0%, transparent 70%)",
          pointerEvents: "none",
        }} />
        <div style={{
          fontFamily: "'DM Sans', sans-serif",
          fontSize: 12, fontWeight: 700,
          color: "#00ff87",
          letterSpacing: "0.2em",
          textTransform: "uppercase",
          marginBottom: 16,
        }}>
          Portugu√™s do Brasil
        </div>
        <h1 style={{
          fontFamily: "'Playfair Display', serif",
          fontSize: "clamp(36px, 7vw, 64px)",
          fontWeight: 700,
          lineHeight: 1.1,
          marginBottom: 16,
          background: "linear-gradient(135deg, #ffffff 30%, #00ff87 100%)",
          WebkitBackgroundClip: "text",
          WebkitTextFillColor: "transparent",
        }}>
          Fala Portugu√™s,
          <br />
          Mano!
        </h1>
        <p style={{
          fontFamily: "'DM Sans', sans-serif",
          fontSize: "clamp(14px, 2.5vw, 18px)",
          color: "#888",
          maxWidth: 480,
          margin: "0 auto",
          lineHeight: 1.6,
        }}>
          Deine Lernplattform f√ºr brasilianisches Portugiesisch.
          <br />
          Von Null auf Flu√™ncia ‚Äì mit echtem Slang und Stra√üensprache.
        </p>
      </header>

      <Nav active={activeSection} setActive={setActiveSection} />

      <main style={{
        maxWidth: 960,
        margin: "0 auto",
        padding: "40px 20px 80px",
      }}>
        {activeSection === "plan" && <PlanSection />}
        {activeSection === "palace" && <PalaceSection />}
        {activeSection === "slang" && <SlangSection />}
        {activeSection === "quiz" && (
          <QuizSection onComplete={() => setQuizCompleted(true)} />
        )}
        {activeSection === "conversa" && (
          <ConversaSection quizDone={quizCompleted} />
        )}
      </main>

      <footer style={{
        textAlign: "center", padding: "24px 20px",
        borderTop: "1px solid rgba(255,255,255,0.04)",
      }}>
        <p style={{
          fontFamily: "'DM Sans', sans-serif",
          fontSize: 12, color: "#444",
        }}>
          Feito com üíö para aprender portugu√™s ¬∑ Vamos nessa! üáßüá∑
        </p>
      </footer>
    </div>
  );
}
